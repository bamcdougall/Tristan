---
title       : Brief Introduction to Pricing Derivatives
subtitle    : Pricing a Call Option with a Two Step Binomial Model
author      : Robby Twesten & Tristan McDougall 
job         : RT Financials
framework   : io2012     # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : [mathjax, bootstrap]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
---

## Outline
### Tools:  
1. Programming Environment
2. Probability
3. Calculus

### Finance Theory:  
1. Future Value of Money
2. Binomial Tree Pricing Model for Option

### Conclusions

--- .class #id

## Programming Environment

### R is a free statistical software package with integrated graphics
* [Open Source Code](http://cran.r-project.org/), Shared Libraries, & [Integrated Development Environment](http://www.rstudio.com/) 
```{r echo=FALSE, warning=FALSE, results='hide', message=FALSE}
require(stringr)
require(slidify)
require(knitr)
require(DiagrammeR)
require(ggplot2)
require(grid)
require(gridExtra)
require(gtable)
require(lubridate)
```

* [Plotting](http://ggplot2.org/), [LaTex](http://www.latex-project.org/) for equations, & [Slide Presentations](https://github.com/ramnathv/slidifyExamples)

### Version Control
* [Git](https://www.git-scm.com) invented by Linus Torvalds (open source Linux)
* [Git Hub](https://github.com/RobertTwesten/Tristan) distributed version control ([used by Google](https://github.com/google))

---
## Tools from Calculus

### Definition of $e$

<div class="centered">
\begin{equation}
    e = \lim_{n\to\infty} (1 + 1/n)^n
\end{equation}
</div>

### Integration

* Assume a [linear measure]( http://en.wikipedia.org/wiki/Measure_(mathematics\) ) in $\Re^1$, then
\begin{equation}
    \int dx = x + C
\end{equation}

### Total Derivative

* Let $f$ be a function of $x(t)$, $y(t)$, and $t$. The total derivative with respect to time is

\begin{equation}
    \frac{d f(x(t), y(t), t)}{d t} = \frac{\partial f}{\partial x} \frac{d x}{d t} + \frac{\partial f}{\partial y} \frac{d y}{d t}
    + \frac{\partial f}{\partial t} \frac{d t}{d t}
\end{equation}

---
## Tools from Statistics

### Observations
* Given a set of observations $\{x_i\}$, the mean is

<div class="centered">
\begin{equation}
    \mu =  \sum_{i=1}^{n} \frac{x_i}{n}
\end{equation}
</div>


* The variance (a measure of disorder) is

<div class="centered">
\begin{equation}
   \sigma^2  =  \sum_{i=1}^n \frac{(x_i - \mu)^2}{n}
\end{equation}
</div>

\begin{equation}
\vdots
\end{equation}

<div class="centered">
\begin{equation}
   \sigma^2  =  E[x^2] - E[x]^2
\end{equation}
</div>

---
## Tools from Probability (1 / 3)
### [Stochastic Processes](http://en.wikipedia.org/wiki/Stochastic_process): observations whose values are random with respect to time


### Markov Process
* Future stock price depends only on current price.
* Distributions are normal. Means are additive. Variances are additive.

### Wiener Process

* Future stock price depends only on current price.
* Distributions are standard normal, i.e. $\mu = 0$ &  $\sigma^2 = 1$.

---
## Tools from Probability (2 / 3)
### Normal Distribution
* Density is
<div class="centered">
\begin{equation}
   f(x) = \frac{1}{\sqrt{2 \pi} \sigma} e^{-(x - \mu)^2/2 \sigma^2}
\end{equation}
</div>

* Center of "bell" curve is at $\mu$ and width determined by $\sigma$

### Standard Normal Distribution
* Characterized by $\mu = 0$ &  $\sigma^2 = 1$

---
## Tools from Probability (3 / 3)
### Monte Carlo Data, Normal Distribution, & Cental Limit Theorm
* Left:  Test scores of 50 students from an exam with $\mu = 70$ & $\sigma = 5$
* Right:  Normalized test scores from 30, 40, & 50 students from an exam $\times$ 1000 simulations

```{r CLTnrml, echo=FALSE, warning=FALSE, fig.width=12, fig.height=5.5}
################################################################################
##
## This code chunk initializes constants used for generating Monte Carlo data##
##
nSims = 1000
mean = 70
sd = 5 # stanard deviation for normal distributions
##
################################################################################
##
## This code chunk generates& plots Monte Carlo data for normal distribution
##
set.seed(314159)
dataNorm <- tbl_df(data.frame(x = rnorm(50, mean, sd)))
helper <- function(x) {dnorm(x, mean, sd)}
plotHistRnorm <- ggplot(dataNorm, aes(x = x)) + geom_histogram(binwidth=.3, aes(y = ..density..), colour = "black", fill = "steelblue")
plotHistRnorm <- plotHistRnorm + stat_function(fun = helper, size = 2) #+ geom_density(alpha=.2, fill="#FF6666")
plotHistRnorm <- plotHistRnorm + labs(x ="Test Score", y="Density", title = "Normal Distribution with mean = 70 and standard deviation = 5")
##
################################################################################
##
## This graph demonstrates arbitrary Normal Distribution & standardizing it
##
set.seed(314159)
rnorm30.frame <- tbl_df(data.frame(matrix(rnorm(nSims*30, mean, sd), nSims)))
set.seed(314159)
rnorm40.frame <- tbl_df(data.frame(matrix(rnorm(nSims*40, mean, sd), nSims)))
set.seed(314159)
rnorm50.frame <- tbl_df(data.frame(matrix(rnorm(nSims*50, mean, sd), nSims)))
# View(rnorm40.frame)

cfunc <- function(x, n) sqrt(n) * (mean(x) - (mean) ) / (sd)
dat <- tbl_df(data.frame(
    x = c(apply(rnorm30.frame, 1, cfunc, 30),
          apply(rnorm40.frame, 1, cfunc, 40),
          apply(rnorm50.frame, 1, cfunc, 50)
    ),
    size = factor(rep(c("30 Students", "40 Students", "50 Students"), rep(1000, 3)))))
#     size = factor(rep(c("30 Students", "40 Students", "50 Students"), rep(1000, 3)))))
# View(dat)
pltLLNnorm <- ggplot(dat, aes(x = x, fill = size)) + geom_histogram(binwidth=.3, colour = "black", aes(y = ..density..)) 
pltLLNnorm <- pltLLNnorm + stat_function(fun = dnorm, size = 2) + 
    labs(y = "Density", title = "Central Limit Theorem:  Normal Distribution")
pltLLNnorm <- pltLLNnorm + facet_grid(. ~ size)

grid.newpage()
pushViewport(viewport(layout = grid.layout(1, 2)))
vplayout <- function(x, y)
    viewport(layout.pos.row = x, layout.pos.col = y)
print(plotHistRnorm, vp = vplayout(1, 1))
print(pltLLNnorm, vp = vplayout(1, 2))

```

---
## Tools from Stochastic Calculus

### Ito's Lemma
* Show definition of Ito's lemma

```{r animationTest, echo=FALSE, fig.height=4, fig.show='animate'}
for(i in 1:10) {
plot(rnorm(100))
}

```

---
## Definitions from Finance

### Stock
* An asset that is partial ownership of a publicly traded firm.


### European Option
* Right to buy (long) or sell (short) an asset (stock) for a strike price at a set time (maturity), for a fee today.


### Call Option
*  The option to buy a stock in the future at a fixed price.
* Two sides:  a buyer and a seller

### Put Option
* The option to sell a stock in the fture at a fixed price.
* Two sides:  a buyer and a seller


---

## Future Value of Money

r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money
$$ Fv_1 = Pv + r(Pv) $$

---

## Future Value of Money


r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money
$$ Fv_1 = Pv + r(Pv) $$
  
### Example:
$$ r = 10\% $$
$$ Pv = $100 $$
$$ Fv_1 = ? $$

---

## Future Value of Money

r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money
$$ Fv_1 = Pv + r(Pv) $$
  
### Example:
$$ Fv_1 = $100 + (10\%)($100) $$
$$ Fv_1 = $110 $$

---

## Future Value of Money

r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money
$$ Fv_1 = Pv + r(Pv) $$

---

## Future Value of Money


r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money
$$ Fv_1 = Pv + r(Pv) $$


$$ Fv_2 = (Fv_1) + r(Fv_1) $$

---

## Future Value of Money

r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money
$$ Fv_1 = Pv + r(Pv) $$

$$ Fv_2 = (Fv_1) + r(Fv_1) $$

$$ Fv_2 = (Pv + r(Pv)) + r(Pv + r(Pv)) $$

---

## Future Value of Money

r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money
$$ Fv_1 = Pv + r(Pv) $$

$$ Fv_2 = (Fv_1) + r(Fv_1) $$


$$ Fv_2 = (Pv + r(Pv)) + r(Pv + r(Pv)) $$






$$ Fv_2 = Pv(1 + 2r + r^2) $$




$$ Fv_2 = Pv(1+r)^2 $$

---

## Future Value of Money

r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money
$$ Fv_1 = Pv + r(Pv) $$



$$ Fv_2 = Pv(1+r)^2 $$

$$ Fv_t = Pv(1+r)^t $$




$$ Fv_t = Pv(1+\frac{r}{n})^{nt} $$


### -t is a time step
### -n is a unit conversion

---

## Future Value of Money

r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money  
n = Unit Conversion  
t = Time Conversion

$$ Fv_t = Pv(1+\frac{r}{n})^{nt} $$

$$ k = \frac{n}{r} $$

$$ n = k*r $$


$$ Fv_t = Pv(1+\frac{1}{k})^{krt} $$

---

## Future Value of Money
r = risk free interest rate   
Pv = Present Value of Money  
Fv = Future Value of Money  

$$  e = \lim_{x\to\infty} (1+\frac{1}{x})^x $$

$$ Fv_t = Pv(\lim_{k\to\infty} (1+\frac{1}{k})^{k})^{rt} $$

$$ Fv_t = Pv (e^{rt}) $$

---
## Future Value of Money

* [Bank Savings interest rate](http://www.mysavingsdirect.com/MySavingsDirectWeb/en/common/information/LearnMore.jsp) $r = 1.25\%$ per annum. Starting balance = [$532.60](http://www.google.com/finance?q=NASDAQ%3AGOOGL&ei=fsF9VfG5JonSjAGE84J4)
* Figure shows continuous, daily, monthly, quarterly, and annual compounding for 10 years
```{r fvMoney, echo=FALSE, warning=FALSE, message=FALSE, fig.height=6, fig.cap="Time Value of Money"}
aprAnn = 0.0125 #https://www.mysavingsdirect.com/MySavingsDirectWeb/en/common/information/LearnMore.jsp
aprDay = aprAnn / yday(mdy("12/31/2015"))
aprMnth = aprAnn / 12
aprQtr = aprAnn / 4

finGrowthTblMnth <- tbl_df(as.data.frame( ymd_hms("2015-01-01 16:00:00", tz = "America/New_York") + months(1:120) - days(1) ))
names(finGrowthTblMnth) <- "dateClose"
finGrowthTblMnth <- finGrowthTblMnth%>%
    mutate(
        ydayNum = yday(dateClose),
        month = month(dateClose),
        years = as.period( (dateClose - ymd_hms("2015-01-02 16:00:00", tz = "America/New_York") ) ) %/% months(12),
        quarters = as.period( (dateClose - ymd_hms("2015-01-02 16:00:00", tz = "America/New_York") ) ) %/% months(3),
        months = as.period( (dateClose - ymd_hms("2015-01-02 16:00:00", tz = "America/New_York") ) ) %/% months(1),
        days = as.period( (dateClose - ymd_hms("2015-01-02 16:00:00", tz = "America/New_York") ) ) %/% days(1),
        Savings = (532.60 * (1 + aprDay)**(days)),
        Contin = (532.60 * exp( aprDay * days) ),
        Mnthly = (532.60 * (1 + aprMnth)**(months)),
        Qtrly = (532.60 * (1 + aprQtr)**(quarters)),
        Annul = (532.60 * (1 + aprAnn)**(years))
        )
    
mnyPlt2 <- ggplot() + scale_colour_hue("Compound_Rate")
mnyPlt2 <- mnyPlt2 + geom_line(data=finGrowthTblMnth, aes(x = dateClose, y = Contin, color = "1_Contin"))
mnyPlt2 <- mnyPlt2 + geom_line(data=finGrowthTblMnth, aes(x = dateClose, y = Savings, color = "2_Daily"))
mnyPlt2 <- mnyPlt2 + geom_line(data=finGrowthTblMnth, aes(x = dateClose, y = Mnthly, color = "3_Mnthly"))
mnyPlt2 <- mnyPlt2 + geom_line(data=finGrowthTblMnth, aes(x = dateClose, y = Qtrly, color = "4_Qtrly"))
mnyPlt2 <- mnyPlt2 + geom_line(data=finGrowthTblMnth, aes(x = dateClose, y = Annul, color = "5_Annul"))
mnyPlt2 <- mnyPlt2 + labs(x = "Date", y = "Amount [$]", title = "Money:  Time Value", legend = "Compounding")
mnyPlt2
```

---
## Risk Neutral Valuation of a Portfolio

### Assumptions
1. The expected return on a stock (or any other investment) is the risk-free rate.
2. The discount rate used for the expected payoff on an option (or any other instrument) is the risk-free rate.

### Purpose
1. Risk Neutral Valuation (RNV) simplifies pricing.

* All returns and discounts are at risk-free rate.

2. Relationship between stock and derivative is the same regardless of risk.

* Risk incorporated into price of stock.

---

## Binomial Tree Model

---

## Portfolio Management

### Risk Free Portfolio (RFP)
* Value of portfolio is same whether stock price goes up or down:

\begin{equation}
    (\Delta S_o) u - f_u = (\Delta S_o) d - f_d
\end{equation}

### $\Delta$ Hedge
* Determine number of shares $\Delta$ required for creating a RFP

\begin{equation}
    \Delta = \frac{f_u - f_d}{S_o (u-d)}
\end{equation}

---
## Pricing Slides (to be done)

* Integration of Stock price $\Delta S / S$ etc.
* Two properties are:

1.  The change $\Delta z$ during a small period of time $\Delta t$ is $\Delta z = \epsilon \sqrt(\Delta t)$ where $\epsilon$ is a standard normal distribution $\Phi(0,1)$.
2.  The values of $\Delta z$ for any two different short intervals of time, $\Delta t$, are independent.

---
## Acknowledgements

### Ms Johnston
* for AP Calculus

### Dr McDougall

* for stimulating discussions regarding Cox, Ross, Rubinstein model,
* introducing a R-programming enviroment, 
* demonstrating Latex,
* introducing GitHub, and
* keeping us at the white board!

